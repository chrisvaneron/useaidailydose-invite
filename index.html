<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Opening AI Daily Dose...</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        text-align: center;
        padding: 2rem;
      }
    </style>
  </head>
  <body>
    <p id="status">Checking your device...</p>

    <script>
      function isMobile() {
        return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      }
      async function recordInvite() {
        const statusEl = document.getElementById("status");

        // if (!isMobile()) {
        //   statusEl.innerHTML = `
        //     <strong>Almost there!</strong><br /><br />
        //     Please open this invite link from your phone or tablet to launch the AI Daily Dose app ðŸª„
        //   `;
        //   return;
        // }

        // Save to Supabase
        try {
          const ipRes = await fetch("https://api64.ipify.org?format=json");
          const ip = (await ipRes.json()).ip;
          const ua = navigator.userAgent;

          const res = await fetch(
            "https://jdowwnetdnnhwgqteaak.supabase.co/functions/v1/recordInvite",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization:
                  "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Impkb3d3bmV0ZG5uaHdncXRlYWFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM4MDgxODAsImV4cCI6MjA1OTM4NDE4MH0.6REF6OnSmfL26hSn3zkEPXFSKGQkFqI7vsuM7YW2UKc",
              },
              body: JSON.stringify({ ip, userAgent: ua }),
            }
          );

          const json = await res.json();
          if (!res.ok) throw new Error(json?.error || "Invite failed");

          statusEl.innerText = "Opening AI Daily Dose...";
          console.log("Fingerprint:", json.fingerprint);
        } catch (err) {
          console.error("Error:", err);
          statusEl.innerText = "Failed to save invite. Try again.";
        }
      }

      recordInvite();
    </script>
  </body>
</html>
